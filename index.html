<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Zack Klinger, Web Developer, Portland, OR</title>
  <!-- load picturefill library -->
  <script src="https://code.jquery.com/jquery-2.2.2.js" integrity="sha256-4/zUCqiq0kqxhZIyp4G0Gk+AOtCJsY1TA00k5ClsZYE=" crossorigin="anonymous"></script>
  <!-- link to Font Awesome stylesheet -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <!-- link to Weather Icons stylesheet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.9/css/weather-icons.min.css">
  <!-- link to main stylesheet -->
  <link rel="stylesheet" type="text/css" href="css/main.css" />
  <!-- Unica One font -->
  <link href='https://fonts.googleapis.com/css?family=Unica+One' rel='stylesheet' type='text/css'>
  <!-- Vollkorn font -->
  <link href='https://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>
  </head>
<body>
  <div class="content-wrapper clear">
    <div class="flex-wrapper">
      <div class="temperature">
        <div class="degrees">52ยบ</div>
        <div class="secondary-temp-info">
          <div class="temp-wind">
            <div class="temp-units">F</div>
            <div class="wind-speed">23</div>
            <div class="wind-units">mph</div>
          </div>
          <div class="clouds"><i class="wi"></i></div>
        </div>
      </div>
      <div class="city">Portland, OR</div>
      <div class="time">10:55 pm</div>
    </div>
  </div>
  <script>
    var weatherIcons = {
      Clouds: "wi-cloudy",
      Rain: "wi-rain",
      Clear: "wi-day-sunny"
    }
    var lon = -122.3787;
    var lat = 45.4741;
    $(document).ready(function() {
      // Initialize weather data
      getWeatherByLocation(lon, lat);
      // Add listener to toggle temp-units
      $(".temp-units").on("click", function(event) {
        $units = $(this).text();
        // toggle units and make new call to weather API
        toggleTempUnits($units);
        $(".wind-units").text($(".wind-units").text() === 'mph' ? 'mps' : 'mph');
        getWeatherByLocation(lon, lat);
      });
      
      //===========
      // Functions
      //===========
      
      // Call Openweather API and update UI
      function getWeatherByLocation(lon, lat) {
        $.ajax({
          url: 'http://api.openweathermap.org/data/2.5/find',
          type: 'GET',
          data: {
            appid: '97c9a860de6de4c40a5e60bf99ea46e1',
            lon: lon,
            lat: lat
          },
          dataType: 'json',
          success: success,
          error: function(err) { alert(err); },
          beforeSend: function(xhr) {
          xhr.setRequestHeader("Content-Type", "application/x-www-form-URLEncoded");
          }
        });
      }
      
      // Success callback
      function success(data) {
        var $tempUnits = $(".temp-units").text();
        setUI(data, $tempUnits);
      }
      
      // Set weather-main elements
      function setUI(data, units) {
        $(".degrees").text(convertTempDegrees(data.list[0].main.temp, units) + 'ยบ');
        $(".clouds").html('<i class="wi ' + weatherIcons[data.list[0].weather[0].main] + '"></i>');
        $(".wind-speed").text(convertWindSpeed(data.list[0].wind.speed, units));
        $(".city").text(data.list[0].name);
      }
      
      // Convert temp degrees
      function convertTempDegrees(kelvins, units) {
        if ('f' === units.toLowerCase()) {
          return Math.round((kelvins - 273.15) * 1.8 + 32);
        } else {
          return Math.round(kelvins - 273.15);
        }
      }
      
      // Convert wind speed
      function convertWindSpeed(speed, units) {
        return Math.floor('f' === units.toLowerCase() ? (speed * 2.23694) : speed);
      }
      
      // Toggle temp units
      function toggleTempUnits(units) {
        $(".temp-units").text('f' === units.toLowerCase() ? 'C' : 'F');
      }

    });
  </script>
</body>
</html>